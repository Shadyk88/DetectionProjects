This detection project is based on an article detailing unauthorized RDP access and provides a set of correlation detections to identify potential exploitation of RDP logins. Unauthorized RDP access can be a critical security issue, allowing attackers to move laterally within a network. Implementing detection mechanisms helps in early identification and response to such activities. I've provided sample queries for a couple of SIEM languages I am familiar with to assist in the development of this detection of said exploitation. I've also provided additional hardening recommendations and the benefits of implementing said detections. 

Policy Recommendation
To enhance security, ensure that only authorized users can access RDP within your environment. This can be enforced by:

    Creating an Active Directory (AD) group specifically for RDP users.
    Requiring IT approval for RDP access.
    Conducting regular reviews by the security team to assess the necessity of RDP access for users.

Detection Recommendations

   1. Failed RDP Authentications (Brute-forcing attempts): - Monitoring for a high number of failed RDP login attempts can help detect brute-force attacks.
   2. Successful RDP authentication from an unauthorized user: - Monitoring for successful RDP events from users not contained a reference setlist which
   3. Unusual RDP logon time : - Monitoring for RDP logins occurring at unusual times (e.g., outside of normal business hours) can help identify suspicious activity.

Benefits of Implementing These Detections

    Enhanced Security: By identifying unauthorized access attempts and successful breaches, organizations can respond promptly to potential threats.
    Compliance: Ensuring only authorized users can access critical systems helps meet compliance requirements for various regulations and standards.
    Proactive Threat Hunting: Regular monitoring and detection of unauthorized RDP activities enable proactive threat hunting, helping to mitigate risks before they escalate.
    Incident Response: Early detection of unauthorized access provides valuable information for incident response teams to contain and investigate security incidents effectively.

1:  Failed RDP Authentications (Brute-forcing attempts)

Splunk Sample Query:

index=wineventlog (however you have it indexed) sourcetype=* EventCode=4625 Logon_Type=10
|where user_count>=15

QRadar Sample Query:


Log Source type = Microsoft Windows Security Event Log
AND when the event matches Event ID (depends on parsing) is any of 4625
AND when the event matches Logon Type (depends on parsing) is any of 10
AND when at least 15 events are seen with the same Source IP,Username,Log Source in 5 minutes

Azure Sentinel Sample Query:

SecurityEvent
|where EventID =="4625"
|where LogonType=="10"
|where event_count>=5


2: Successfully authentications via RDP from unauthorized users:

Splunk Sample Query:
index=wineventlog sourcetype=* EventCode=4624 Logon_type=10
|search NOT
|inputlookup (authorizedRDPusers.csv)

QRadar Sample Query:
Log Source type = Microsoft Windows Security Event Log
AND when the event matches Event ID (depends on parsing) is any of 4624
AND when the event matches Logon Type (depends on parsing) is any of 10
AND when Username contained in any of Authorized_users_RDP reference set list


Azure Sentinel Sample Query:

SecurityEvent
|where EventID=="4624"
|where LogonType=="10"
|where SubjectUsername(could also be username) in authorized_users_RDP_v01

3: Unusual RDP logon time

Splunk Sample Query"
index=wineventlog sourcetype=* EventCode=4624 Logon_Type=10
| eval hour=strftime(_time, "%H")
| where hour < 6 OR hour > 18

QRadar Sample Query:
Log Source type = Microsoft Windows Security Event Log
AND Event ID is any of 4624
AND Logon Type is any of 10
AND NOT when flow(s) or event(s) occur before 06:00 
AND NOT when flow(s) or event(s) occur after 18:00

Azure Sentinel Sample Query:
SecurityEvent
| where EventID == 4624
| where LogonType == 10
| extend hour = format_datetime(TimeGenerated, 'HH')
| where hour < '06' or hour > '18'


Refernces:
https://www.ultimatewindowssecurity.com/securitylog/book/page.aspx?spid=chapter3
https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4625
https://www.hawk-eye.io/2023/04/threat-hunting-unauthorized-rdp-post-exploitation/
